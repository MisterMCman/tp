generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Trainer {
  id        Int           @id @default(autoincrement())
  firstName String
  lastName  String
  email     String        @unique
  phone     String
  bio       String?       @db.Text
  profilePicture String?
  status    TrainerStatus @default(ACTIVE)
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  inquiries Inquiry[]
  invoices  Invoice[]
  topics    TrainerTopic[]
  loginTokens LoginToken[]
}

model LoginToken {
  id        Int      @id @default(autoincrement())
  token     String   @unique
  trainerId Int
  trainer   Trainer  @relation(fields: [trainerId], references: [id])
  createdAt DateTime @default(now())
  expiresAt DateTime
  used      Boolean  @default(false)
  usedAt    DateTime?

  @@index([trainerId], map: "LoginToken_trainerId_fkey")
}

model Topic {
  id       Int       @id @default(autoincrement())
  name     String    @unique
  trainers TrainerTopic[]
  courses  Course[]
}

model TrainerTopic {
  id        Int      @id @default(autoincrement())
  trainer   Trainer  @relation(fields: [trainerId], references: [id])
  trainerId Int
  topic     Topic    @relation(fields: [topicId], references: [id])
  topicId   Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  @@unique([trainerId, topicId]) // Eindeutiger Index statt Primärschlüssel
}

model Inquiry {
  id            Int           @id @default(autoincrement())
  trainerId     Int
  eventId       Int
  status        InquiryStatus @default(PENDING)
  originalPrice Float
  proposedPrice Float
  counterPrice  Float?
  message       String?       @db.Text
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  event         Event         @relation(fields: [eventId], references: [id])
  trainer       Trainer       @relation(fields: [trainerId], references: [id])

  @@index([eventId], map: "Inquiry_eventId_fkey")
  @@index([trainerId], map: "Inquiry_trainerId_fkey")
}

model Event {
  id           Int           @id @default(autoincrement())
  courseId     Int
  title        String
  date         DateTime
  endTime      DateTime
  location     String
  participants Int           @default(0)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  course       Course        @relation(fields: [courseId], references: [id])
  inquiries    Inquiry[]
  eventParticipants Participant[]

  @@index([courseId], map: "Event_courseId_fkey")
}

model Course {
  id          Int         @id @default(autoincrement())
  description String?     @db.Text
  createdAt   DateTime    @default(now())
  state       CourseState @default(ONLINE)
  title       String
  topicId     Int?
  topic       Topic?      @relation(fields: [topicId], references: [id])
  updatedAt   DateTime    @updatedAt
  events      Event[]

  @@index([topicId], map: "Course_topicId_fkey")
}

model Participant {
  id      Int    @id @default(autoincrement())
  name    String
  email   String
  eventId Int
  event   Event  @relation(fields: [eventId], references: [id])

  @@index([eventId], map: "Participant_eventId_fkey")
}

model Invoice {
  id        Int           @id @default(autoincrement())
  trainerId Int
  courseId  Int?
  amount    Float
  status    InvoiceStatus @default(SUBMITTED)
  createdAt DateTime      @default(now())
  trainer   Trainer       @relation(fields: [trainerId], references: [id])

  @@index([trainerId], map: "Invoice_trainerId_fkey")
}

enum TrainerStatus {
  ACTIVE
  INACTIVE
}

enum InquiryStatus {
  PENDING
  ACCEPTED
  REJECTED
  ABGESAGT
}

enum CourseState {
  ONLINE
  INACTIVE
}

enum InvoiceStatus {
  SUBMITTED
  PAID
}
